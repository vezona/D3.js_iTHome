---
title: 圖表RWD
layout: ./app/layout.ejs
engine: ejs
current: index
---

<style>

.chart{
    width: 100%;
    min-width: 300px;
    margin: auto;
}
</style>

<h1 class="text-center fw-bold">Line Chart 折線圖</h1>

<h4 class="mt-3">2021 COVID-19 每週感染病例數</h4>
<div class="chart"></div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// 疾病管制署 https://nidss.cdc.gov.tw/nndss/disease?id=19CoV


  let data = []
  async function getData() {
    // 取資料
    dataGet = await d3.csv('./data/20201-202140-covid19.csv')
    console.log(dataGet.filter(i=>i['發病年週']>'202101'))
    data = dataGet.filter(i=>i['發病年週']>'202101')
    drawChart()
  };
  getData()

  // RWD
  function drawChart(){
    // 刪除原本的svg.charts，重新渲染改變寬度的svg
    d3.select('.chart svg').remove();

    // RWD 的svg 寬高
    const rwdSvgWidth = parseInt(d3.select('.chart').style('width')),
          rwdSvgHeight = rwdSvgWidth*0.8,
          margin = 40,
          bandWidth = 20 

    const svg = d3.select('.chart')
                  .append('svg')
                  .attr('width', rwdSvgWidth)
                  .attr('height', rwdSvgHeight);


    // map 資料集
    xData = data.map((i) => parseInt(i['發病年週'].substring(4,6))); // 取週數
    yData = data.map((i) => parseInt(i['確定病例數']));
    console.log(xData)

    // 設定要給 X 軸用的 scale 跟 axis
    const xScale = d3.scaleLinear()
                    .domain(d3.extent(xData))
                    .range([margin, rwdSvgWidth - margin]); // 寬度

    // rwd X軸的刻度
    let tickNumber = window.innerWidth > 450 ? null : 5;
    const xAxis = d3.axisBottom(xScale)
                    .ticks(tickNumber)
                    .tickFormat(d=>d+'週')

    // 呼叫繪製x軸、調整x軸位置
    const xAxisGroup = svg.append("g")
                          .call(xAxis)
                          .attr("transform", `translate(0,${rwdSvgHeight - margin})`)

    // 設定要給 Y 軸用的 scale 跟 axis
    const yScale = d3.scaleLinear()
                    .domain([0, d3.max(yData)])
                    .range([rwdSvgHeight - margin, margin]); // 數值要顛倒，才會從低往高排

    const yAxis = d3.axisLeft(yScale)
                    .ticks(5)

    // 呼叫繪製y軸、調整y軸位置
    const yAxisGroup = svg.append("g")
                          .call(yAxis)
                          .attr("transform", `translate(${margin},0)`)
                    
    // 開始建立折線圖
    // 設定折線圖相關資料
    const lineChart = d3.line()
              .x((d) => xScale(parseInt(d['發病年週'].substring(4,6))))
              .y((d) => yScale(parseInt(d['確定病例數'])))
              // .defined((d) => d.pinPrice > 0)
              .curve(d3.curveLinear); //決定曲線線條

    svg.append('path')
      .data(data)
      .attr("d", lineChart(data))
      .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-width", 1.5)
      
  }

  d3.select(window).on('resize', drawChart);


</script>
