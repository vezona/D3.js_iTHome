---
title: svg
layout: ./app/layout.ejs
engine: ejs
current: index
---

<style>
  svg {
    outline: 1px solid red;
  }
  p {
    margin-top: 1rem !important;
    margin-bottom: 0.5rem !important;
  }
</style>

<!-- DOM -->
<div>
  <p>svg 視窗範圍：高100 X 寬500</p>
  <div class="">
    <p>長度300的線</p>
    <svg width="500" height="100">
      <line x1="10" x2="310" y1="50" y2="50" 
      stroke="black" stroke-width="5">
    </svg>
  </div>
  <div class="">
    <p>長度600的線：超出視圖範圍，因此需要比例尺，將整個圖形換算成符合視圖範圍的比例</p>
    <svg width="500" height="100">
      <line x1="10" x2="610" y1="50" y2="50" 
      stroke="black" stroke-width="5">
    </svg>
  </div>
</div>

<div class="chartContainer"></div>
<button type="button" id="start" class="btn btn-primary">動畫開始</button>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script>
// 輸入與輸出比例換算範例
const convert = d3.scaleLinear()
                  .domain([0, 100])
                  .range([0, 10])
                  // .clamp(true)
console.log(convert(50)); // 5，換算輸出比例完成

// 換算顏色
const colorScale = d3.scaleLinear()
										.domain([0, 10])
										.range(['yellow', 'red']);

colorScale(0);   // returns "rgb(255, 255, 0)"
colorScale(5);   // returns "rgb(255, 128, 0)"
colorScale(10);  // returns "rgb(255, 0, 0)"

// sequentialScale
let sequentialScale = d3.scaleSequential()
  .domain([0, 100])
  .interpolator(d3.interpolateRainbow);
console.log(sequentialScale(50))

// band
let bandScale = d3.scaleBand()
  .domain(['狗', '貓', '天竺鼠', '烏龜', '海豚']) // 共有五條長條圖
  .range([0, 200]); // 整張圖表的範圍
console.log(bandScale('海豚'))

// point
let pointScale = d3.scalePoint()
  .domain(['狗', '貓', '天竺鼠', '烏龜', '海豚']) // 共有五條長條圖
  .range([0, 200]); // 整張圖表的範圍
console.log(pointScale('海豚'))
console.log('step',pointScale.step())


//現在我有兩筆資料
let data1 = [5, 2, 3, 6, 1, 3, 3, 5, 3, 7, 2, 1];
let data2 = [8, 6, 10, 4, 5, 2, 6, 3, 1, 12, 3, 7];


let n = data1.length, //資料點的數量
    mx = d3.max(d3.merge([data1, data2])) //抓兩個陣列的最大值

// svg
const svg = d3.select('.chartContainer').append('svg');
svg.attr('width', 500)
    .attr('height', 500);

// 繪製XY圖表範圍
const scX = d3.scaleLinear()
    .domain([0, n]) //x軸的值
    .range([30, 500])
const scY = d3.scaleLinear()
    .domain([0, mx]) //Y軸的值
    .range([500, 0])

svg.selectAll('line')
    .data(data1)
    .enter()
    .append('line')
    .attr('stroke', 'orange')
    .attr('stroke-width', 20)
    .attr('x1', (d, i) => scX(i))
    .attr('y1', scY(0))
    .attr('x2', (d, i) => scX(i))
    .attr('y2', (d, i) => scY(d))

// 動畫開始
d3.select('#start')
  .on('click', function () {
    svg.selectAll('line')
        .data(data2)
        .transition()
        .duration(1000) //點擊之後每個bar會在1秒內到達更新位置
        .delay((d, i) => 200 * i) //每個bar在分別delay後才開始動畫，
        // delay時間承上X軸index，做出從左至右更新的動畫效果
        .attr('y2', (d, i) => scY(d))
        // transition串接
        // 會繼承先前transition的duration 跟delay
        .transition().attr('stroke', '#66f9ff')
});


</script>